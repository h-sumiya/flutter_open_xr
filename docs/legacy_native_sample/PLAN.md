# Flutterの画面をOpenXRの空間に表示するための計画 (Windows Only)

#### 手順1：OpenXR上で空間に長方形を描画

**完璧な第一歩です。**
`hello_xr` のD3D11バックエンドをベースにします。最初はキューブなどが回転していると思いますが、最終的にFlutterのUIを表示するために、OpenXRの **`XrCompositionLayerQuad`**（空間に配置できる高品質な2Dの板ポリゴンレイヤー）を表示できるように改造します。

まずはこのQuadに、市松模様や適当な単色のD3D11テクスチャを貼ってHorizon Link上に表示できればクリアです。

#### 手順2：Windows上で「オフスクリーン」にFlutterを描画

ここがこのプロジェクトの要です。テストとしてカスタムWindow（HWND）に出すのも良いですが、次の手順3をスムーズにするために、目標を**「Window（画面）には何も出さず、メモリ上のD3D11テクスチャ（`ID3D11Texture2D`）に対してFlutterを描画する（オフスクリーンレンダリング）」**ことと定義するのがおすすめです。

`embedder.h` の `FlutterRendererConfig` を設定し、コールバック関数経由でFlutterのUIのピクセルデータがD3D11のテクスチャに書き込まれる状態を作ります。

#### 手順3：統合（テクスチャの受け渡し）

手順1と手順2を合体させます。

1. アプリ起動時にD3D11の描画デバイス（`ID3D11Device`）を1つ作成します。
2. それをOpenXRの初期化と、Flutterの初期化（Custom Embedder）の両方に渡して**共有**します。
3. Flutter側（手順2）で更新されたテクスチャを、毎フレームOpenXR側（手順1）のQuadレイヤーのスワップチェーン画像にコピーして表示します。

#### 手順4：入力のサポート（コントローラー連携）

VR空間での操作を実現します。
OpenXRのアクションシステムを使って、Questコントローラーの「ポーズ（位置と向き）」と「トリガーのクリック」を取得します。
コントローラーから伸びるRay（光線）と、空間上のQuadレイヤーとの交差判定（レイキャスト）を行い、「Quad上のどのXY座標（2D）を指しているか」を計算します。そのXY座標を `FlutterEngineSendPointerEvent` を使ってFlutter側にマウス/タッチイベントとして流し込みます。
